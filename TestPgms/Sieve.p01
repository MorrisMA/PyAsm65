   1    2 	.stk	1024
   2    3 	.cod	512
   3    4 STATIC_LINK			.equ	+5
   4    5 RETURN_VALUE		.equ	-3
   5    6 HIGH_RETURN_VALUE	.equ	-1
   6    7 _start
   7    8 	tsx.w
   8    9 	lds.w	#16383
   9   10 	jmp	_pc65_main
  10   20 _pc65_main	.sub
  11   21 	phx.w
  12   22 	tsx.w
  13   24 	lda.w #1000
  14   25 	pha.w
  15   26 	lda #2
  16   27 	pha.w
  17   28 	jsr _idiv
  18   29 	adj #4
  19   30 	sta.w limit_005
  20   32 	psh.w #sieve_002
  21   33 	lda #1
  22   34 	dec.w a
  23   35 	asl.w a
  24   36 	clc
  25   37 	adc.w 1,S
  26   38 	sta.w 1,S
  27   39 	lda #0
  28   40 	pli
  29   41 	sta.w 0,I++
  30   44 	lda #2
  31   45 	sta.w i_003
  32   46 L_008
  33   47 	lda.w #1000
  34   48 	cmp.w i_003
  35   49 	bge L_009
  36   50 	jmp L_010
  37   51 L_009
  38   53 	psh.w #sieve_002
  39   54 	lda.w i_003
  40   55 	dec.w a
  41   56 	asl.w a
  42   57 	clc
  43   58 	adc.w 1,S
  44   59 	sta.w 1,S
  45   60 	lda #1
  46   61 	pli
  47   62 	sta.w 0,I++
  48   63 	inc.w i_003
  49   64 	jmp L_008
  50   65 L_010
  51   66 	dec.w i_003
  52   69 	lda #1
  53   70 	sta.w prime_006
  54   73 L_011
  55   75 	lda.w prime_006
  56   76 	pha.w
  57   77 	lda #1
  58   78 	clc
  59   79 	adc.w 1,S
  60   80 	adj #2
  61   81 	sta.w prime_006
  62   83 L_013
  63   84 	psh.w #sieve_002
  64   85 	lda.w prime_006
  65   86 	dec.w a
  66   87 	asl.w a
  67   88 	clc
  68   89 	adc.w 1,S
  69   90 	sta.w 1,S
  70   91 	pli
  71   92 	lda.w 0,I++
  72   93 	eor #1
  73   94 	cmp.w #1
  74   95 	beq L_014
  75   96 	jmp L_015
  76   97 L_014
  77   99 	lda.w prime_006
  78  100 	pha.w
  79  101 	lda #1
  80  102 	clc
  81  103 	adc.w 1,S
  82  104 	adj #2
  83  105 	sta.w prime_006
  84  106 	jmp L_013
  85  107 L_015
  86  110 	lda #2
  87  111 	pha.w
  88  112 	lda.w prime_006
  89  113 	pha.w
  90  114 	jsr _imul
  91  115 	adj #4
  92  116 	sta.w factor_007
  93  119 L_016
  94  120 	lda.w factor_007
  95  121 	pha.w
  96  122 	lda.w #1000
  97  123 	xma.w 1,S
  98  124 	cmp.w 1,S
  99  125 	adj #2
 100  126 	php
 101  127 	lda #1
 102  128 	plp
 103  129 	ble L_019
 104  130 	lda #0
 105  131 L_019
 106  132 	cmp.w #1
 107  133 	beq L_017
 108  134 	jmp L_018
 109  135 L_017
 110  137 	psh.w #sieve_002
 111  138 	lda.w factor_007
 112  139 	dec.w a
 113  140 	asl.w a
 114  141 	clc
 115  142 	adc.w 1,S
 116  143 	sta.w 1,S
 117  144 	lda #0
 118  145 	pli
 119  146 	sta.w 0,I++
 120  148 	lda.w factor_007
 121  149 	pha.w
 122  150 	lda.w prime_006
 123  151 	clc
 124  152 	adc.w 1,S
 125  153 	adj #2
 126  154 	sta.w factor_007
 127  157 	jmp L_016
 128  158 L_018
 129  159 	lda.w prime_006
 130  160 	pha.w
 131  161 	lda.w limit_005
 132  162 	xma.w 1,S
 133  163 	cmp.w 1,S
 134  164 	adj #2
 135  165 	php
 136  166 	lda #1
 137  167 	plp
 138  168 	bgt L_020
 139  169 	lda #0
 140  170 L_020
 141  171 	cmp.w #1
 142  172 	beq L_012
 143  173 	jmp L_011
 144  174 L_012
 145  177 	psh.w #S_021
 146  178 	psh.w #0
 147  179 	psh.w #21
 148  180 	jsr _swrite
 149  181 	adj #6
 150  182 	jsr _writeln
 151  184 	jsr _writeln
 152  187 	lda #1
 153  188 	sta.w i_003
 154  190 L_022
 155  192 	lda #0
 156  193 	sta.w j_004
 157  194 L_024
 158  195 	lda #19
 159  196 	cmp.w j_004
 160  197 	bge L_025
 161  198 	jmp L_026
 162  199 L_025
 163  201 	lda.w i_003
 164  202 	pha.w
 165  203 	lda.w j_004
 166  204 	clc
 167  205 	adc.w 1,S
 168  206 	adj #2
 169  207 	sta.w prime_006
 170  209 	psh.w #sieve_002
 171  210 	lda.w prime_006
 172  211 	dec.w a
 173  212 	asl.w a
 174  213 	clc
 175  214 	adc.w 1,S
 176  215 	sta.w 1,S
 177  216 	pli
 178  217 	lda.w 0,I++
 179  218 	cmp.w #1
 180  219 	beq L_027
 181  220 	jmp  L_028
 182  221 L_027
 183  223 	lda.w prime_006
 184  224 	pha.w
 185  225 	lda #3
 186  226 	pha.w
 187  227 	jsr _iwrite
 188  228 	adj #4
 189  230 	jmp L_029
 190  231 L_028
 191  233 	psh.w #S_030
 192  234 	psh.w #0
 193  235 	psh.w #3
 194  236 	jsr _swrite
 195  237 	adj #6
 196  238 L_029
 197  240 	inc.w j_004
 198  241 	jmp L_024
 199  242 L_026
 200  243 	dec.w j_004
 201  245 	jsr _writeln
 202  247 	lda.w i_003
 203  248 	pha.w
 204  249 	lda #20
 205  251 	clc
 206  252 	adc.w 1,S
 207  253 	adj #2
 208  254 	sta.w i_003
 209  255 	lda.w i_003
 210  256 	pha.w
 211  258 	lda.w #1000
 212  259 	xma.w 1,S
 213  260 	cmp.w 1,S
 214  261 	adj #2
 215  262 	php
 216  263 	lda #1
 217  264 	plp
 218  265 	bgt L_031
 219  266 	lda #0
 220  267 L_031
 221  268 	cmp.w #1
 222  269 	beq L_023
 223  270 	jmp L_022
 224  271 L_023
 225  272 	plx.w
 226  273 	rts
 227  274 	.end	_pc65_main
 228  276 	.dat
 229  278 sieve_002	.byt	2000
 230  279 i_003	.byt	2
 231  280 j_004	.byt	2
 232  281 limit_005	.byt	2
 233  282 prime_006	.byt	2
 234  283 factor_007	.byt	2
 235  284 S_030	.str	"   "
 236  285 S_021	.str	"Sieve of Eratosthenes"
 237  287 	.end
